angular.module("ez.table.paginator",[]).constant("EzTableConfig",{limit:10,limits:[5,10,25,100],paginasPorAdelantado:4,sortField:null,sortAscending:!0,globalSearchField:void 0,showBatchActions:!1}).directive("ezTablePaginator",["$filter","$timeout","EzTableConfig",function(a,b,c){return{restrict:"A",scope:!0,compile:function(a){var d,e,f,g="<thead><tr>",h=a.find("tbody tr:first-child td");g+='<th><input class="batch-checkbox" type="checkbox" ng-model="isToggled" ng-change="toggleAll()" ng-show="showBatchActions" /></th>';for(var i=1;i<h.length-1;i++){if(d=angular.element(h[i]).data("title"),!d)throw new Error('data-title attribute must be specified for column "'+i+'"');e=d.charAt(0).toLowerCase()+d.slice(1),f=angular.element(h[i]).data("field")||e,g+="<th class=\"sorting\" ng-class=\"{'sorting_asc': !sortAscending && sortField == '"+f+"', 'sorting_desc': sortAscending && sortField == '"+f+"'} \" ng-click=\"sort('"+f+"')\">"+d+"<span ng-show=\"sortField == '"+e+"'\" ></span></th>"}g+="<th></th></tr></thead>",a.prepend(g);var j='<tfoot><tr>                     <tr>                      <td colspan="100%">                         <div class="row" >                             <div class="limit-selector col-md-6">                                 <a ng-click="pager.setRowsPerPage(10)" ng-class="{active: limit == 10}" >10</a><span>|</span>                                 <a ng-click="pager.setRowsPerPage(25)" ng-class="{active: limit == 25}" >25</a><span>|</span>                                 <a ng-click="pager.setRowsPerPage(50)" ng-class="{active: limit == 50}" >50</a>                             </div>                             <div class="col-md-6 dataTables_paginate paging_bootstrap">                                 <div class="dataTables_paginate paging_bootstrap">                                     <!-- pagination -->                                     <ul class="pagination pagination-sm" ng-show="pager.totalPages > 0" >                                         <li ng-class="{disabled: pager.currentPage == 1}">                                             <a ng-click="prev()" ><i class="fa fa-chevron-left"></i></a>                                         </li>                                         <li ng-repeat="page in pager.pages" class="" ng-class="{active: pager.currentPage === page, inactive: pager.currentPage !== page}">                                             <a ng-click="setPage(page -1)">                                                 {{page }}                                             </a>                                         </li>                                         <li ng-class="{disabled: pager.currentPage == pager.totalPages}">                                             <a ng-click="next()" ><i class="fa fa-chevron-right"></i></a>                                         </li>                                     </ul>                                </div>                             </div>                         </div>                     </td>                      </tr>                 </tfoot>';return a.append(j),a.addClass("table ez-table table-striped table-hover table-full-width dataTable "),function(a,d,e){a.limit=parseInt(e.limit,10)||c.limit,a.paginasPorAdelantado=parseInt(e.paginasPorAdelantado,10)||c.paginasPorAdelantado,a.limits=a.$eval(e.limits)||c.limits,a.sortField=e.sortField||c.sortField,a.sortAscending=a.$eval(e.sortAscending)||c.sortAscending,a.showBatchActions=a.$eval(e.showBatchActions)||c.showBatchActions;var f=a.$eval(e.globalSearch)||c.globalSearchField;a.pager={},a.pager.currentPage=1,a.pager.maxPages=7,a.pager.rowsPerPage=a.limit,a.pager.setPage=function(b){if(b&&(a.pager.currentPage=parseInt(b,10)),a.pager.maxPages<a.pager.totalPages){var c=Math.max(a.pager.currentPage-Math.floor(a.pager.maxPages/2),1),d=c+a.pager.maxPages-1;for(d>a.pager.totalPages&&(d=a.pager.totalPages,c=d-a.pager.maxPages+1),a.pager.pages=[],c;d>=c;c++)a.pager.pages.push(c)}},a.pager.next=function(){return a.pager.currentPage<a.pager.totalPages&&a.pager.setPage(++a.pager.currentPage),a.pager.currentPage},a.pager.prev=function(){return a.pager.currentPage>1&&a.pager.setPage(--a.pager.currentPage),a.pager.currentPage},a.pager.refresh=function(){a.pager.totalRows=a.pages.length*a.limit,a.pager.totalPages=Math.ceil(a.pager.totalRows/a.pager.rowsPerPage);var b=parseInt(1,10),c=a.pager.totalPages<a.pager.maxPages?a.pager.totalPages:a.pager.maxPages;for(a.pager.pages=[],b;c>=b;b++)a.pager.pages.push(b)},a.pager.setRowsPerPage=function(b){a.pager.rowsPerPage=a.limit=b,a.setPage(0)},a.currentPage=0,a.batchAction="",a.filters={},a.setPage=function(b){a.currentPage=b,0===a.currentPage||a.pages[a.currentPage].length!==a.limit||a.pages[a.currentPage+1]||(a.$parent.$parent.searchParams.limiteInferior=a.currentPage*a.limit+1,a.$parent.$parent.searchParams.limiteSuperior=a.currentPage*a.limit+a.paginasPorAdelantado*a.limit,a.$parent.$parent.search(),a.actualizado=!0,a.actualizadoDesde=b),a.items=a.pages[b],a.pager.setPage(b+1)},a.calcPages=function(b){var c=[];if(c=a.$eval(e.ezTablePaginator),a.actualizado){a.actualizado=!1;for(var d=a.actualizadoDesde;d<a.actualizadoDesde+a.paginasPorAdelantado&&(a.pages[d]=c.slice((d-a.actualizadoDesde)*a.limit,(d-a.actualizadoDesde)*a.limit+a.limit),!(a.pages[d].length<a.limit));d++);return a.pager.refresh(),void a.setPage(b)}a.pageCount=c.length/a.limit,a.pages=[];for(var f=0;f<a.pageCount;f++)a.pages[f]=c.slice(f*a.limit,f*a.limit+a.limit);a.pager.refresh(),a.setPage(b)},a.toggleAll=function(){angular.forEach(a.items,function(b,c){a.items[c]._selected=a.isToggled})},a.prev=function(){a.items=a.pages[a.pager.prev()-1],a.isToggled=!1},a.next=function(){a.setPage(a.pager.next()-1),a.isToggled=!1},a.sort=function(b){a.sortAscending=!a.sortAscending,a.sortField=b,a.$parent.$parent.searchParams.limiteInferior=1,a.$parent.$parent.searchParams.limiteSuperior=a.limit*a.pager.maxPages,a.$parent.$parent.searchParams.ordenarPor=b,a.$parent.$parent.searchParams.orden=a.sortAscending?"asc":"desc",a.pages={},a.$parent.$parent.search(),a.calcPages(0)},a.filter=function(){a.$parent.$parent.searchParams.limiteInferior=1,a.$parent.$parent.searchParams.limiteSuperior=a.limit*a.pager.maxPages,a.$parent.$parent.searchParams.palabraClave=f,a.pages={},a.$parent.$parent.search(),a.calcPages(0)},a.$watch("limit",function(b,c){b!==c&&(a.$parent.$parent.searchParams.limiteInferior=1,a.$parent.$parent.searchParams.limiteSuperior=a.limit*a.pager.maxPages,a.pages={},a.$parent.$parent.search(),a.calcPages(0))}),a.$watch(e.ezTablePaginator,function(b){if(a.showBatchActions=!1,b){var c=b.length;angular.forEach(b,function(b,d){return b._selected?void(a.showBatchActions=!0):void(d+1===c&&(a.isToggled=!1))}),a.calcPages(a.pager.currentPage-1)}},!0),a.$watch(e.globalSearch,function(c,d){c!==d&&(a.timeOut&&b.cancel(a.timeOut),a.timeOut=b(function(){f=c,a.filter()},3e3))})}}}}]),angular.module("ez.table",[]).constant("EzTableConfig",{limit:10,limits:[5,10,25,100],sortField:null,sortAscending:!1,globalSearchField:void 0,showBatchActions:!1}).directive("ezTable",["$filter","$timeout","EzTableConfig",function(a,b,c){return{restrict:"A",scope:!0,compile:function(d){var e,f,g,h="<thead><tr>",i='<tr ng-show="showFilters"><th></th>',j=d.find("tbody tr:first-child td");h+='<th><input class="batch-checkbox" type="checkbox" ng-model="isToggled" ng-change="toggleAll()" ng-show="showBatchActions" /></th>';for(var k=1;k<j.length-1;k++){if(e=angular.element(j[k]).data("title"),!e)throw new Error('data-title attribute must be specified for column "'+k+'"');f=e.charAt(0).toLowerCase()+e.slice(1),g=angular.element(j[k]).data("field")||f,h+="<th class=\"sorting\" ng-class=\"{'sorting_asc': !sortAscending && sortField == '"+g+"', 'sorting_desc': sortAscending && sortField == '"+g+"'} \" ng-click=\"sort('"+g+"')\">"+e+"<span ng-show=\"sortField == '"+f+"'\" ></span></th>",i+='<th><input class="form-control" ng-model="filters.'+g+'" type="text" ng-change="filter(\''+g+"')\"/></th>"}h+="<th></th></tr>",i+="<th></th></tr>",h+=i+"</thead>",d.prepend(h);var l='<tfoot><tr>                     <tr>                      <td colspan="100%">                         <div class="row" >                             <div class="limit-selector col-md-6">                                 <a ng-click="pager.setRowsPerPage(10)" ng-class="{active: limit == 10}" >10</a><span>|</span>                                 <a ng-click="pager.setRowsPerPage(25)" ng-class="{active: limit == 25}" >25</a><span>|</span>                                 <a ng-click="pager.setRowsPerPage(50)" ng-class="{active: limit == 50}" >50</a>                             </div>                             <div class="col-md-6 dataTables_paginate paging_bootstrap">                                 <div class="dataTables_paginate paging_bootstrap">                                     <!-- pagination -->                                     <ul class="pagination pagination-sm" ng-show="pager.totalPages > 0" >                                         <li ng-class="{disabled: pager.currentPage == 1}">                                             <a ng-click="prev()" ><i class="fa fa-chevron-left"></i></a>                                         </li>                                         <li ng-repeat="page in pager.pages" class="" ng-class="{active: pager.currentPage === page, inactive: pager.currentPage !== page}">                                             <a ng-click="setPage(page -1)">                                                 {{page }}                                             </a>                                         </li>                                         <li ng-class="{disabled: pager.currentPage == pager.totalPages}">                                             <a ng-click="next()" ><i class="fa fa-chevron-right"></i></a>                                         </li>                                     </ul>                                </div>                             </div>                         </div>                         <a ng-hide="true" class="filter-toggle btn btn-sm btn-default" ng-click="showFilters = !showFilters" title="Toggle Filters"><i class="icon-search"></i><span>Search</span></a>                     </td>                      </tr>                 </tfoot>';return d.append(l),d.addClass("table ez-table table-striped table-hover table-full-width dataTable "),function(d,e,f){d.limit=parseInt(f.limit,10)||c.limit,d.limits=d.$eval(f.limits)||c.limits,d.sortField=f.sortField||c.sortField,d.sortAscending=d.$eval(f.sortAscending)||c.sortAscending,d.showBatchActions=d.$eval(f.showBatchActions)||c.showBatchActions;var g=d.$eval(f.globalSearch)||c.globalSearchField;d.pager={},d.pager.currentPage=1,d.pager.maxPages=7,d.pager.rowsPerPage=d.limit,d.pager.setPage=function(a){if(a&&(d.pager.currentPage=parseInt(a,10)),d.pager.maxPages<d.pager.totalPages){var b=Math.max(d.pager.currentPage-Math.floor(d.pager.maxPages/2),1),c=b+d.pager.maxPages-1;for(c>d.pager.totalPages&&(c=d.pager.totalPages,b=c-d.pager.maxPages+1),d.pager.pages=[],b;c>=b;b++)d.pager.pages.push(b)}},d.pager.next=function(){return d.pager.currentPage<d.pager.totalPages&&d.pager.setPage(++d.pager.currentPage),d.pager.currentPage},d.pager.prev=function(){return d.pager.currentPage>1&&d.pager.setPage(--d.pager.currentPage),d.pager.currentPage},d.pager.refresh=function(a){d.pager.totalRows=a.length,d.pager.totalPages=Math.ceil(a.length/d.pager.rowsPerPage);var b=parseInt(1,10),c=d.pager.totalPages<d.pager.maxPages?d.pager.totalPages:d.pager.maxPages;for(d.pager.pages=[],b;c>=b;b++)d.pager.pages.push(b)},d.pager.setRowsPerPage=function(a){d.pager.rowsPerPage=d.limit=a,d.setPage(0)},d.currentPage=0,d.batchAction="",d.filters={},d.setPage=function(a){d.currentPage=a,d.items=d.pages[a],d.pager.setPage(a+1)},d.calcPages=function(b){var c=[];for(var e in d.filters)break;c=d.sortField?a("orderBy")(d.$eval(f.ezTable),d.sortField,!d.sortAscending):d.$eval(f.ezTable),e&&(c=a("filter")(c,d.filters)),g&&(c=a("filter")(c,{$:g})),d.pageCount=c.length/d.limit,d.pages=[];for(var h=0;h<d.pageCount;h++)d.pages[h]=c.slice(h*d.limit,h*d.limit+d.limit);d.pager.refresh(c),d.setPage(b)},d.toggleAll=function(){angular.forEach(d.items,function(a,b){d.items[b]._selected=d.isToggled})},d.prev=function(){d.items=d.pages[d.pager.prev()-1],d.isToggled=!1},d.next=function(){d.items=d.pages[d.pager.next()-1],d.isToggled=!1},d.sort=function(a){d.sortAscending=!d.sortAscending,d.sortField=a,d.calcPages(d.currentPage)},d.filter=function(){d.calcPages(0)},d.$watch("limit",function(a,b){a!==b&&d.calcPages(0)}),d.$watch(f.ezTable,function(a){if(d.showBatchActions=!1,a){var b=a.length;angular.forEach(a,function(a,c){return a._selected?void(d.showBatchActions=!0):void(c+1===b&&(d.isToggled=!1))}),d.calcPages(d.pager.currentPage-1)}},!0),d.$watch(f.globalSearch,function(a,c){a!==c&&b(function(){g=a,d.filter()},300)})}}}}]);